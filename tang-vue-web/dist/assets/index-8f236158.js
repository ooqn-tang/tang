import{u as M,d as c,x as u,y as m,z as t,I as f,C as i,F as h,B as x,E as p,R as g,k as _,M as N,S as y,v as C}from"./router-b176819d.js";import"./request-02cf91c6.js";class H{constructor(e){this.messageFunctionList={},this.messageHeader={},this.socket=new WebSocket(e),this.messageQueue=[],this.socket.onopen=s=>{console.log(s),this.sendAll()},this.socket.onmessage=s=>{let a=JSON.parse(s.data);a.code!=null?this.messageHeader[a.code](a):this.messageFunctionList[a.messageId](a)},this.socket.onclose=s=>{},this.socket.onerror=s=>{}}setHeader(e,s){this.messageHeader[e]=s}send(e,s){e.messageId=Math.random(),this.messageFunctionList[e.messageId]=s,this.messageQueue.push(e),this.sendAll()}sendAll(){for(;this.messageQueue.length>0&&this.socket.readyState===1;){let e=this.messageQueue.shift();this.socket.send(JSON.stringify(e))}}getUserInfo(e){this.send({code:1e3},e)}login(e){this.send({code:"Login",params:{jwt:localStorage.getItem("jwt")}},e)}sendMessage(e,s,a){this.send({code:"SendMessage",params:{username:s,text:e}},a)}watchList(e){this.send({code:"WatchList"},e)}messageList(e,s){this.send({code:"MessageList",params:{memberName:e}},s)}}const I={class:"row h100"},D={class:"h100",style:{display:"flex","flex-direction":"column",height:"100%",padding:"0px"}},F=y('<div class="input-group" style="margin-bottom:1px;"><input type="text" class="form-control" aria-label="Text input with segmented dropdown button"><button type="button" class="btn btn-outline-secondary">搜索</button><button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span></button><ul class="dropdown-menu dropdown-menu-end"><li><a class="dropdown-item" href="#">增加好友</a></li><li><a class="dropdown-item" href="#">增加群</a></li><li><a class="dropdown-item" href="#">创建群</a></li></ul></div>',1),T={class:"box",style:{height:"100%","flex-grow":"1","overflow-y":"auto",padding:"5px",border:"1px solid #dee2e6",margin:"5px 0px 0px 0px"}},A={class:"box-list"},B=["onClick"],Q={style:{color:"#bbbbbb"}},R={class:"h100",style:{display:"flex","flex-direction":"column",height:"100%",padding:"0px"}},J={class:"card",style:{border:"1px solid rgb(222, 226, 230)"}},O={class:"card-body",style:{padding:"6px 10px","vertical-align":"top",display:"inline-block"}},U={class:"align-middle"},V={class:"box",style:{height:"100%","flex-grow":"1","overflow-y":"auto",padding:"5px",border:"1px solid #dee2e6",margin:"5px 0px"}},q={class:"box-list"},z={style:{"border-bottom":"0"}},E={style:{color:"rgb(8, 78, 184)","font-weight":"bold"}},W={style:{border:"1px solid black","border-radius":"5px",padding:"5px"}},$={class:"input-group input-group-sm"},j=y('<div class="modal fade show modal-rgba modal-lg"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="exampleModalLabel">聊天室</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form><div class="mb-3"><label for="recipient-name" class="col-form-label">用户地址:</label><input type="text" class="form-control" id="recipient-name" placeholder="账号地址 @bobcbui:ooqn.com"></div><div class="mb-3"><label for="recipient-name" class="col-form-label">邮箱/手机号：</label><input type="text" class="form-control" id="recipient-name"></div><div class="mb-3"><label for="message-text" class="col-form-label">密码：</label><input type="text" class="form-control" id="recipient-name"></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button><button type="button" class="btn btn-primary">登录</button></div></div></div></div>',1),X={__name:"index",setup(w){let e=M(),s=c("right"),a=c(""),r=c([]),b=c({}),k="wss://www.ooqn.com/_monster/"+e.username;var d=new H(k);d.setHeader("Message",o=>{r.value.push(o.data),console.log(o)}),d.setHeader("MessageList",o=>{r.value.push(o.data),console.log(o.data)}),d.login(o=>{console.log(JSON.stringify(o))});function L(){let o={acceptName:b.value.username,sendName:e.username,content:a.value,createTime:new Date,updateTime:new Date};r.value.push(o),a.value="",d.sendMessage(a.value,b.value.username,l=>{l.status==200&&console.log(l.message)})}function S(o){b.value=o,d.messageList(o.username,l=>{l.status==200&&(r.value=l.data)})}let v=c([]);return d.watchList(o=>{o.status==200&&(v.value=o.data)}),(o,l)=>(u(),m(h,null,[t("div",I,[t("div",{class:f(["col-md-4 h100 pb-2",i(s)=="left"?"":"m-h"])},[t("div",D,[F,t("div",T,[t("div",A,[(u(!0),m(h,null,x(i(v),n=>_((u(),m("div",{onClick:G=>{S(n),g(s)?s.value="right":s="right"}},[t("p",null,p(n.nickname),1),t("p",Q,p(n.signature)+" ",1)],8,B)),[[C,n.username!=i(e).username]])),256))])])])],2),t("div",{class:f(["col-md-8 h100 pb-2",i(s)=="right"?"":"m-h"])},[t("div",R,[t("div",J,[t("div",O,[t("span",U,p(i(b).nickname),1),t("span",{style:{float:"right"},onClick:l[0]||(l[0]=n=>g(s)?s.value="left":s="left")}," ✖️ ")])]),t("div",V,[t("div",q,[(u(!0),m(h,null,x(i(r),n=>(u(),m("div",z,[t("p",E,p(n.sendName),1),t("p",W,p(n.content)+" ",1)]))),256))])]),t("div",$,[_(t("input",{"onUpdate:modelValue":l[1]||(l[1]=n=>g(a)?a.value=n:a=n),type:"text",class:"form-control",placeholder:"Recipient's username","aria-label":"Recipient's username","aria-describedby":"button-addon2"},null,512),[[N,i(a)]]),t("button",{class:"btn btn-outline-secondary",type:"button",id:"button-addon2",onClick:l[2]||(l[2]=n=>L())},"发送")])])],2)]),j],64))}};export{X as default};
