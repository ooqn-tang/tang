import{u as k,d as c,x as d,y as r,z as t,F as b,B as h,C as u,k as v,M as L,R as S,S as _,v as M,E as p}from"./router-f99ea542.js";import"./request-02cf91c6.js";class H{constructor(e){this.messageFunctionList={},this.messageHeader={},this.socket=new WebSocket(e),this.messageQueue=[],this.socket.onopen=s=>{console.log(s),this.sendAll()},this.socket.onmessage=s=>{let a=JSON.parse(s.data);a.code!=null?this.messageHeader[a.code](a):this.messageFunctionList[a.messageId](a)},this.socket.onclose=s=>{},this.socket.onerror=s=>{}}setHeader(e,s){this.messageHeader[e]=s}send(e,s){e.messageId=Math.random(),this.messageFunctionList[e.messageId]=s,this.messageQueue.push(e),this.sendAll()}sendAll(){for(;this.messageQueue.length>0&&this.socket.readyState===1;){let e=this.messageQueue.shift();this.socket.send(JSON.stringify(e))}}getUserInfo(e){this.send({code:1e3},e)}login(e){this.send({code:"Login",params:{jwt:localStorage.getItem("jwt")}},e)}sendMessage(e,s,a){this.send({code:"SendMessage",params:{username:s,text:e}},a)}watchList(e){this.send({code:"WatchList"},e)}messageList(e,s){this.send({code:"MessageList",params:{memberName:e}},s)}}const N={class:"row h100"},C={class:"col-md-4 h100 pb-2"},D={class:"h100",style:{display:"flex","flex-direction":"column",height:"100%",padding:"0px"}},F=_('<div class="input-group" style="margin-bottom:1px;"><input type="text" class="form-control" aria-label="Text input with segmented dropdown button"><button type="button" class="btn btn-outline-secondary">搜索</button><button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span></button><ul class="dropdown-menu dropdown-menu-end"><li><a class="dropdown-item" href="#">增加好友</a></li><li><a class="dropdown-item" href="#">增加群</a></li><li><a class="dropdown-item" href="#">创建群</a></li></ul></div>',1),I={class:"box",style:{height:"100%","flex-grow":"1","overflow-y":"auto",padding:"5px",border:"1px solid #dee2e6",margin:"5px 0px 0px 0px"}},T={class:"box-list"},A=["onClick"],B={style:{color:"#bbbbbb"}},Q={class:"col-md-8 h100 pb-2 pc"},R={class:"h100",style:{display:"flex","flex-direction":"column",height:"100%",padding:"0px"}},J=t("div",{class:"card"},[t("div",{class:"card-body",style:{padding:"6px 10px","vertical-align":"top",display:"inline-block"}},[t("span",{class:"align-middle"},"这是文本"),t("span",{style:{float:"right"}}," ✖️ ")])],-1),O={class:"box",style:{height:"100%","flex-grow":"1","overflow-y":"auto",padding:"5px",border:"1px solid #dee2e6",margin:"5px 0px"}},U={class:"box-list"},V={style:{"border-bottom":"0"}},q={style:{color:"rgb(8, 78, 184)","font-weight":"bold"}},E={style:{border:"1px solid black","border-radius":"5px",padding:"5px"}},W={class:"input-group input-group-sm"},z=_('<div class="modal fade show modal-rgba modal-lg"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="exampleModalLabel">聊天室</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form><div class="mb-3"><label for="recipient-name" class="col-form-label">用户地址:</label><input type="text" class="form-control" id="recipient-name" placeholder="账号地址 @bobcbui:ooqn.com"></div><div class="mb-3"><label for="recipient-name" class="col-form-label">邮箱/手机号：</label><input type="text" class="form-control" id="recipient-name"></div><div class="mb-3"><label for="message-text" class="col-form-label">密码：</label><input type="text" class="form-control" id="recipient-name"></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button><button type="button" class="btn btn-primary">登录</button></div></div></div></div>',1),K={__name:"index",setup(f){let e=k(),s=c(""),a=c([]),m=c({}),x="wss://www.ooqn.com/_monster/"+e.username;var i=new H(x);i.setHeader("Message",o=>{a.value.push(o.data),console.log(o)}),i.setHeader("MessageList",o=>{a.value.push(o.data),console.log(o.data)}),i.login(o=>{console.log(JSON.stringify(o))});function y(){let o={acceptName:m.value.username,sendName:e.username,content:s.value,createTime:new Date,updateTime:new Date};a.value.push(o),i.sendMessage(s.value,m.value.username,n=>{n.status==200&&console.log(n.message)})}function w(o){m.value=o,i.messageList(o.username,n=>{n.status==200&&(a.value=n.data)})}let g=c([]);return i.watchList(o=>{o.status==200&&(g.value=o.data)}),(o,n)=>(d(),r(b,null,[t("div",N,[t("div",C,[t("div",D,[F,t("div",I,[t("div",T,[(d(!0),r(b,null,h(u(g),l=>v((d(),r("div",{onClick:$=>w(l)},[t("p",null,p(l.nickname),1),t("p",B,p(l.signature)+" ",1)],8,A)),[[M,l.username!=u(e).username]])),256))])])])]),t("div",Q,[t("div",R,[J,t("div",O,[t("div",U,[(d(!0),r(b,null,h(u(a),l=>(d(),r("div",V,[t("p",q,p(l.sendName),1),t("p",E,p(l.content)+" ",1)]))),256))])]),t("div",W,[v(t("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>S(s)?s.value=l:s=l),type:"text",class:"form-control",placeholder:"Recipient's username","aria-label":"Recipient's username","aria-describedby":"button-addon2"},null,512),[[L,u(s)]]),t("button",{class:"btn btn-outline-secondary",type:"button",id:"button-addon2",onClick:n[1]||(n[1]=l=>y())},"发送")])])])]),z],64))}};export{K as default};
