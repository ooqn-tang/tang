<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:v-on="http://www.w3.org/1999/xhtml"
      xmlns:v-bind="http://www.w3.org/1999/xhtml">
<!--å¯¼èˆªèœå•-->
<div th:fragment="navigation">
    <nav role="navigation" class="navbar navbar-default navbar-static-top" style="margin-bottom: 10px;">
        <div class="container">
            <div class="navbar-header">
                <button type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="/" class="navbar-brand">å ‚å ‚ç¨‹åºå‘˜</a>
            </div>
            <div id="bs-example-navbar-collapse-1" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">é¦–é¡µ</a></li>
                </ul>
                <form class="navbar-form navbar-left">
                    <div class="input-group" id="search">
                        <input autocapitalize="none" autocomplete="off" autocorrect="off" type="text" class="form-control" v-model="searchValue" th:value="${title}" placeholder="è¾“å…¥å…³é”®å­—" name="s">
                        <span class="input-group-btn">
                        <button type="button" class="btn btn-default" @click="searchClick">æœç´¢</button>
                    </span>
                    </div>
                    <script>
                        new Vue({
                            el: "#search",
                            data: {
                                searchValue:""
                            },
                            methods: {
                                searchClick(){
                                    let search = getQueryVariable("s");
                                    if(search !== null){
                                        index.search(this.searchValue)
                                    }else{
                                        window.location.href = "/so?s=" + this.searchValue
                                    }
                                }
                            }
                        })
                    </script>
                </form>
                <ul class="nav navbar-nav navbar-right">
                    <li><a th:if="${session.SPRING_SECURITY_CONTEXT}!= null" href="/editor" target="_blank">å‘å¸ƒ</a></li>
                    <li><a th:if="${session.SPRING_SECURITY_CONTEXT}!= null" th:href="@{/author/{username}(username=${session.SPRING_SECURITY_CONTEXT.authentication.principal.username})}">æˆ‘çš„</a></li>
                    <li th:if="${session.SPRING_SECURITY_CONTEXT}== null"><a data-toggle="modal" data-target="#loginModal" onclick="login.rImg()">ç™»é™†</a></li>
                </ul>
            </div>
        </div>
    </nav>
</div>

<div th:fragment="login">
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" data-backdrop="static" aria-hidden="true">
        <form>
            <div class="modal-content">
                <!--Modal æ ‡é¢˜-->
                <div class="modal-header">
                    <h4 class="modal-title text-center" v-text="title"></h4>
                </div>
                <div class="modal-body" id = "model-body">
                    <!--æ³¨å†Œï¼Œå¿˜è®°å¯†ç é‚®ç®±-->
                    <label v-if="title == 'æ³¨å†Œ' || title == 'å¿˜è®°å¯†ç '">é‚®ç®±ï¼š</label>
                    <div class="form-group" v-if="title == 'æ³¨å†Œ' || title == 'å¿˜è®°å¯†ç '">
                        <input type="text" class="form-control" placeholder="é‚®ç®±å·" v-model="author.mail" autocomplete="off">
                    </div>
                    <!--ç™»å½•æ—¶æ˜¾ç¤º-->
                    <label v-if="title == 'ç™»å½•'">é‚®ç®± / ç”¨æˆ·åï¼š</label>
                    <div class="form-group" v-if="title == 'ç™»å½•'">
                        <input type="text" class="form-control" placeholder="ç”¨æˆ·å" v-model="author.username" autocomplete="off">
                    </div>
                    <label>å¯†ç ï¼š</label>
                    <div class="form-group">
                        <input type="password" class="form-control" placeholder="å¯†ç " v-model="author.password" autocomplete="off">
                    </div>
                    <label v-if="title == 'æ³¨å†Œ' || title == 'å¿˜è®°å¯†ç '">ç¡®è®¤å¯†ç ï¼š</label>
                    <div class="form-group" v-if="title == 'æ³¨å†Œ' || title == 'å¿˜è®°å¯†ç '">
                        <input type="password" class="form-control" placeholder="å¯†ç " v-model="author.confirmPassword" autocomplete="off">
                    </div>
                    <label v-text="yzm + (mailCount > 0 ? mailCount : '')"></label>
                    <div class="input-group">
                        <input type="text" class="form-control" v-model="author.verify">
                        <span v-if="title == 'ç™»å½•'" class="input-group-addon" style="padding: 0"><img alt="éªŒè¯ç " @click="rImg" v-bind:src="verifyUrl" height="32"/> </span>
                        <span class="input-group-btn" v-if="title != 'ç™»å½•'">
                            <button class="btn btn-default" type="button" @click="sendVerify">è·å–éªŒè¯ç </button>
                        </span>
                    </div>
                    <input type="checkbox" name="remember-me" checked="checked" class="hidden"/>
                </div>
                <div class="modal-footer">
                    <div class="btn-group W100" style="margin-bottom: 10px" v-if="title == 'ç™»å½•'">
                        <button type="button" class="btn btn-default W33">QQ</button>
                        <button type="button" class="btn btn-default W33">å¾®ä¿¡</button>
                        <button type="button" class="btn btn-primary W34" @click="login()">ç™»å½•</button>
                    </div>
                    <div class="btn-group W100" style="margin-bottom: 10px" v-if="title == 'æ³¨å†Œ'">
                        <button type="button" class="btn btn-primary W100" @click="register()">ç¡®è®¤æ³¨å†Œ</button>
                    </div>
                    <div class="btn-group W100" style="margin-bottom: 10px" v-if="title == 'å¿˜è®°å¯†ç '">
                        <button type="button" class="btn btn-primary W100"  @click="password()">ä¿®æ”¹å¯†ç </button>
                    </div>
                    <div class="btn-group W100">
                        <a type="button" class="btn btn-default W33" v-if="title != 'ç™»å½•'" @click="title='ç™»å½•',yzm='éªŒè¯ç ï¼š'">è´¦æˆ·ç™»å½•</a>
                        <a type="button" class="btn btn-default W33" v-if="title != 'æ³¨å†Œ'" @click="title='æ³¨å†Œ',yzm='é‚®ç®±éªŒè¯ç ï¼š'">æ³¨å†Œè´¦æˆ·</a>
                        <a type="button" class="btn btn-default W33" v-if="title != 'å¿˜è®°å¯†ç '" @click="title='å¿˜è®°å¯†ç ',yzm='é‚®ç®±éªŒè¯ç ï¼š'">å¿˜è®°å¯†ç </a>
                        <a type="button" class="btn btn-default W34" data-dismiss="modal">å–æ¶ˆç™»å½•</a>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <script>
        let login = new Vue({
            el:"#loginModal",
            data:{
                zc:true,
                dl:false,
                title:"ç™»å½•",
                yzm:"éªŒè¯ç ",
                author:{
                    username:"",
                    password:"",
                    confirmPassword:"",
                    verify:"",
                    mail:"",
                    'remember-me':true
                },
                mailCount:0,
                verifyUrl:""
            },
            methods: {
                login(){
                    let _this = this
                    $.ajax({
                        type:"POST",
                        url:"/doLogin",
                        contentType: "application/x-www-form-urlencoded",
                        data:_this.author,
                        dataType:"JSON",
                        error:function (err){
                            if(err.responseText == "ç™»å½•æˆåŠŸ"){
                                location.reload();
                            }else{
                                alert(err.responseText)
                                _this.rImg()
                            }
                        }
                    });
                },
                rImg(){
                    this.verifyUrl = "/verify?t=" + Date.parse(new Date())
                },
                sendVerify(){
                    let _this = this
                    _this.mailCount = 60
                    $.ajax({
                        type:"POST",
                        url:"/verifyMail/" + _this.author.mail
                    });
                    setInterval(() => {
                        setTimeout(function(){
                            _this.mailCount -= 1
                        },0)
                    }, 1000)
                },
                register(){
                    let _this = this;
                    if (this.author.password === this.author.confirmPassword){
                        $.ajax({
                            type:"POST",
                            url:"/author/register",
                            contentType: "application/json;charset=UTF-8",
                            data:JSON.stringify(_this.author),
                            dataType:"JSON",
                            success:function(result){
                                alert(result)
                            },
                            error(e){
                                alert(JSON.stringify(e.responseText))
                                _this.rImg()
                            }
                        });
                        return
                    }
                    alert("ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´")
                },
                password(){
                    let _this = this;
                    if (this.author.password === this.author.confirmPassword) {
                        $.ajax({
                            type: "POST",
                            url: "/author/password",
                            contentType: "application/json;charset=UTF-8",
                            data: JSON.stringify(_this.author),
                            dataType: "JSON",
                            success: function (result) {
                                alert(result)
                            }
                        });
                        return
                    }
                    alert("ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´")
                }
            },
            mounted(){
                this.rImg()
            }
        })
    </script>
</div>


<div th:fragment="advertise">
    <div class="list-group" >
        <a class="list-group-item active">å¹¿æ’­<span class="pull-right">ğŸ‡</span></a>
        <a target="_blank" class="list-group-item" th:each="advertise : ${application.advertises}" th:text="${advertise.title}" th:href="${advertise.url}"></a>
    </div>
    <div class="panel panel-default" style="margin-bottom: 60px">
        <div class="panel-body">
            <p><a href="http://www.ttcxy.net/post/0b0d396713a54e2fbf714478d740e53e" target="_blank">å…³äº</a></p>
            <p><a href="http://www.ttcxy.net/post/98b255d539f743e193e398bfa9b97cfd" target="_blank">å‹æƒ…é“¾æ¥</a></p>
            <p><a href="http://beian.miit.gov.cn" target="_blank">æ¹˜ICPå¤‡20009234å·</a></p>
            <a class="hidden" href="/map">åœ°å›¾</a>
        </div>
    </div>
</div>

</html>